# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## ‚úÖ –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

–í–∞—à –±–æ—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **polling** —Ä–µ–∂–∏–º - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- ‚úÖ **HTTPS –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è** –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
- ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ `http://localhost` 
- ‚úÖ –ë–æ—Ç —Å–∞–º –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç Telegram API

## üìã –í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: Polling (—Ç–µ–∫—É—â–∏–π, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

**–†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏!** –ë–æ—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç polling –≤ `bot.py`:

```python
application.run_polling(allowed_updates=Update.ALL_TYPES)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç HTTPS
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- ‚úÖ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ó–∞–ø—É—Å–∫:**
```bash
cd telegram-bot
python bot.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: ngrok (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω Webhook –∏–ª–∏ Telegram Mini App)

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–µ–Ω **Telegram Mini App** (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–Ω—É—Ç—Ä–∏ Telegram) –∏–ª–∏ webhook:

#### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok

**Windows:**
1. –°–∫–∞—á–∞–π—Ç–µ: https://ngrok.com/download
2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ `ngrok.exe` –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://ngrok.com (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
4. –ü–æ–ª—É—á–∏—Ç–µ authtoken –≤ –¥–∞—à–±–æ—Ä–¥–µ
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ: `ngrok config add-authtoken YOUR_TOKEN`

#### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å

```bash
# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
ngrok http 8000
```

–í—ã –ø–æ–ª—É—á–∏—Ç–µ HTTPS URL –≤–∏–¥–∞: `https://xxxx-xx-xxx-xxx-xx.ngrok-free.app`

#### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

–í `.env` —Ñ–∞–π–ª–µ:
```env
TELEGRAM_WEBHOOK_URL=https://xxxx-xx-xxx-xxx-xx.ngrok-free.app/webhook
BACKEND_URL=http://localhost:8000  # –î–ª—è –±–æ—Ç–∞ –≤—Å–µ –µ—â–µ localhost
```

#### –®–∞–≥ 4: –ò–∑–º–µ–Ω–∏—Ç–µ –±–æ—Ç–∞ –Ω–∞ webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –≤–º–µ—Å—Ç–æ polling:

```python
# –í bot.py –≤–º–µ—Å—Ç–æ application.run_polling()
webhook_url = config("TELEGRAM_WEBHOOK_URL", default="")
if webhook_url:
    application.run_webhook(
        listen="0.0.0.0",
        port=8443,
        webhook_url=webhook_url,
        url_path="webhook"
    )
else:
    application.run_polling()
```

**–í–∞–∂–Ω–æ:** –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ webhook –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ polling!

### –í–∞—Ä–∏–∞–Ω—Ç 3: –õ–æ–∫–∞–ª—å–Ω—ã–π HTTPS (–¥–ª—è Mini App)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram Mini App –ª–æ–∫–∞–ª—å–Ω–æ:

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

**Windows (PowerShell –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞):**
```powershell
# –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
$cert = New-SelfSignedCertificate -DnsName "localhost" -CertStoreLocation "cert:\LocalMachine\My"

# –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ —Ñ–∞–π–ª—ã
Export-Certificate -Cert $cert -FilePath "localhost.cer"
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ OpenSSL:
```bash
openssl req -x509 -newkey rsa:4096 -nodes -out localhost.crt -keyout localhost.key -days 365 -subj "/CN=localhost"
```

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ backend –¥–ª—è HTTPS

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/run_https.py`:

```python
import uvicorn
import ssl

if __name__ == "__main__":
    ssl_context = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)
    ssl_context.load_cert_chain("localhost.crt", "localhost.key")
    
    uvicorn.run(
        "app.main:app",
        host="0.0.0.0",
        port=8443,
        ssl_keyfile="localhost.key",
        ssl_certfile="localhost.crt",
        reload=True
    )
```

#### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å HTTPS

```bash
cd backend
python run_https.py
```

**‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:** –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Polling** (—Ç–µ–∫—É—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç) - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç HTTPS

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Mini App:
‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok** - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–∏—Ç—å HTTPS

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ webhook –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –¥–æ–º–µ–Ω–µ —Å –≤–∞–ª–∏–¥–Ω—ã–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º

## üì± Telegram Mini App

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Telegram Mini App (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–Ω—É—Ç—Ä–∏ Telegram):

1. **–¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS** (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok)
2. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –¥–æ–±–∞–≤—å—Ç–µ:
   ```
   /newapp
   ```
3. –£–∫–∞–∂–∏—Ç–µ HTTPS URL –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä—è–º–æ –≤ Telegram

## üîß –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í–∞—à –±–æ—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

```python
# bot.py —Å—Ç—Ä–æ–∫–∞ 143
application.run_polling(allowed_updates=Update.ALL_TYPES)
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:**
- ‚úÖ –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ HTTPS
- ‚úÖ –ë–æ—Ç –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram API –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Webhook –ù–ï –Ω—É–∂–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

## ‚ùì –í–æ–ø—Ä–æ—Å—ã

**Q: –ù—É–∂–µ–Ω –ª–∏ HTTPS –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞?**  
A: –ù–µ—Ç! Polling —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ HTTP.

**Q: –ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω HTTPS?**  
A: –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Telegram Mini App –∏–ª–∏ webhook (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å webhook –ª–æ–∫–∞–ª—å–Ω–æ?**  
A: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ ngrok, –Ω–æ polling –ø—Ä–æ—â–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Telegram Bot API - Polling vs Webhook](https://core.telegram.org/bots/api#getting-updates)
- [ngrok Documentation](https://ngrok.com/docs)
- [Telegram Mini Apps](https://core.telegram.org/bots/webapps)

