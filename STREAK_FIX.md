# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å—Ç—Ä–∞–π–∫–æ–º (streak_days)

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∑–∞–¥–∞—á–∏ –¥–≤–∞ –¥–Ω—è –ø–æ–¥—Ä—è–¥, –Ω–æ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "1 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥" –≤–º–µ—Å—Ç–æ "2 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥".

## –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `update_streak()` –≤ —Ñ–∞–π–ª–µ `backend/app/api/v1/gamification.py`:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å timezone**: 
   - `last_entry_date` —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ `DateTime(timezone=True)`, –Ω–æ –≤ –∫–æ–¥–µ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –æ–±—ä–µ–∫—Ç `date` –±–µ–∑ timezone
   - –ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –¥–∞—Ç –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–ë–î –∏ –∫–æ–¥) –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ timezone

2. **–£—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ç–æ–¥ `datetime.utcnow()`**:
   - –í `transactions.py` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `datetime.utcnow()` –≤–º–µ—Å—Ç–æ `datetime.now(timezone.utc)`

3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞—Ç**:
   - `last_entry_date` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `datetime` —Å timezone, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ `date`

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `update_streak()` –≤ `gamification.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –¥–∞—Ç –∫ UTC timezone
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `last_entry_date` –∫–∞–∫ `datetime` —Å timezone (–Ω–∞—á–∞–ª–æ –¥–Ω—è –≤ UTC)
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞—Ç —Å —É—á–µ—Ç–æ–º timezone
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ `last_entry_date` –º–æ–∂–µ—Ç –±—ã—Ç—å `datetime` –∏–ª–∏ `date`

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
1. –ü–µ—Ä–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Üí `streak_days = 1`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–∞—Ç–∞ –≤ UTC
2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å ‚Üí —Å—Ç—Ä–∞–π–∫ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è
3. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å ‚Üí `streak_days += 1`, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∞—Ç–∞
4. –ü—Ä–æ–ø—É—â–µ–Ω –¥–µ–Ω—å ‚Üí `streak_days = 1`, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–π–∫

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `datetime.utcnow()` –≤ `transactions.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ó–∞–º–µ–Ω–µ–Ω `datetime.utcnow()` –Ω–∞ `datetime.now(timezone.utc)`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `timezone` –∏–∑ –º–æ–¥—É–ª—è `datetime`

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
profile.last_entry_date = transaction_date.date()  # ‚ùå –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è date –±–µ–∑ timezone
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
profile.last_entry_date = datetime.combine(current_date_utc, datetime.min.time()).replace(tzinfo=timezone.utc)  # ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è datetime —Å UTC timezone
```

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

1. **–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: `streak_days = 1`

2. **–í—Ç–æ—Ä–æ–π –¥–µ–Ω—å (—Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å):**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: `streak_days = 2` (–±—ã–ª–æ: –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å 1)

3. **–¢—Ä–µ—Ç–∏–π –¥–µ–Ω—å:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: `streak_days = 3`

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –í—Å–µ –¥–∞—Ç—ã —Ç–µ–ø–µ—Ä—å –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∫ UTC –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º
- `last_entry_date` –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `datetime` —Å timezone UTC (–Ω–∞—á–∞–ª–æ –¥–Ω—è)
- –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ –ë–î –¥–∞—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ UTC –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

## üöÄ –î–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å—Ç—Ä–∞–π–∫–æ–º –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
2. –ù–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç—Ä–∞–π–∫
3. –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —É –∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç—Ä–∞–π–∫ "–∑–∞—Å—Ç—Ä—è–ª" –Ω–∞ 1, –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)

## üìã –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `backend/app/api/v1/gamification.py` - —Ñ—É–Ω–∫—Ü–∏—è `update_streak()`
- `backend/app/api/v1/transactions.py` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `datetime.now(timezone.utc)`

