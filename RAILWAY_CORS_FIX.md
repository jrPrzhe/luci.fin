# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã CORS 400 Bad Request –Ω–∞ Railway

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö Railway –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏:
```
INFO: 100.64.0.2:59020 - "OPTIONS /api/v1/auth/telegram HTTP/1.1" 400 Bad Request
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

–≠—Ç–æ –æ—à–∏–±–∫–∞ CORS (Cross-Origin Resource Sharing). OPTIONS –∑–∞–ø—Ä–æ—Å—ã - —ç—Ç–æ preflight –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º. –ï—Å–ª–∏ origin (–∞–¥—Ä–µ—Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞) –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω –≤ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö backend, —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 Bad Request.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ CORS_ORIGINS

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –Ω–∞ Railway
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à **Backend —Å–µ—Ä–≤–∏—Å**
3. –û—Ç–∫—Ä–æ–π—Ç–µ **Variables** (–∏–ª–∏ **Settings** ‚Üí **Variables**)
4. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `CORS_ORIGINS` –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é:

**–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
- –û—Ç–∫—Ä–æ–π—Ç–µ –µ—ë –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤—å—Ç–µ URL –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ Vercel —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é

**–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ—Ç:**
- –ù–∞–∂–º–∏—Ç–µ **+ New Variable**
- **Name**: `CORS_ORIGINS`
- **Value**: `https://your-app.vercel.app` (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL)

**–ï—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–∞—Ö:**
```
https://your-app.vercel.app,https://your-custom-domain.com
```

**–í–∞–∂–Ω–æ:** 
- –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–±–µ–ª—ã –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç—ã—Ö
- URL –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `https://` (–∏–ª–∏ `http://` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–Ω—ã–π URL, –≤–∫–ª—é—á–∞—è –ø–æ–¥–¥–æ–º–µ–Ω

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç

–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:
```
https://your-app.vercel.app
```

–ò–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ URL —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:
```
https://your-app.vercel.app,https://your-custom-domain.com
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:
1. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å
2. –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ **Redeploy** –≤—Ä—É—á–Ω—É—é

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –æ—à–∏–±–∫–∏ `400 Bad Request` –¥–ª—è OPTIONS –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å.

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–æ–≤ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, preview deployments –Ω–∞ Vercel):

```env
CORS_ORIGINS=https://your-app.vercel.app,https://your-app-git-main.vercel.app,https://your-custom-domain.com
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ wildcard (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã Vercel (–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è production):

–í –∫–æ–¥–µ —É–∂–µ –µ—Å—Ç—å regex –¥–ª—è Vercel –¥–æ–º–µ–Ω–æ–≤: `https://.*\.vercel\.app`

–ù–æ –ª—É—á—à–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã –≤ `CORS_ORIGINS`.

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–õ–æ–≥–∏ Railway:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ **Deployments** ‚Üí **View Logs**
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `400 Bad Request` –¥–ª—è OPTIONS –∑–∞–ø—Ä–æ—Å–æ–≤

2. **Frontend –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Network**
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ API
   - OPTIONS –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `200 OK` –∏–ª–∏ `204 No Content`

3. **CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏:**
   - –í –æ—Ç–≤–µ—Ç–µ OPTIONS –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏:
     - `Access-Control-Allow-Origin: https://your-app.vercel.app`
     - `Access-Control-Allow-Methods: GET, POST, PUT, DELETE, PATCH, OPTIONS`
     - `Access-Control-Allow-Headers: *`

## üö® –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –Ω–∞ Vercel
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ—á–Ω—ã–π URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://your-app-abc123.vercel.app`)
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —ç—Ç–æ—Ç URL —Ç–æ—á–Ω–æ —É–∫–∞–∑–∞–Ω –≤ `CORS_ORIGINS` –Ω–∞ Railway

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–í –ª–æ–≥–∞—Ö Railway –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ CORS, –æ–Ω–∏ —É–∫–∞–∂—É—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π origin.

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
- ‚úÖ `CORS_ORIGINS` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ Variables
- ‚úÖ –§–æ—Ä–º–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤, —Å `https://`)
- ‚úÖ URL —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥

–í `backend/app/main.py` CORS middleware –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
```python
allow_origins=cors_origins,  # –ò–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π CORS_ORIGINS
allow_origin_regex=r"https://.*\.vercel\.app",  # Regex –¥–ª—è –≤—Å–µ—Ö Vercel –¥–æ–º–µ–Ω–æ–≤
```

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Vercel –¥–æ–º–µ–Ω (`.vercel.app`), –æ–Ω –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ regex.

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –û–¥–∏–Ω –¥–æ–º–µ–Ω Vercel
```env
CORS_ORIGINS=https://luci-fin.vercel.app
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–µ–Ω–æ–≤
```env
CORS_ORIGINS=https://luci-fin.vercel.app,https://luci-fin-git-main.vercel.app,https://fin.example.com
```

### –ü—Ä–∏–º–µ—Ä 3: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ + Production
```env
CORS_ORIGINS=http://localhost:5173,https://luci-fin.vercel.app
```

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `CORS_ORIGINS` Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏.

















