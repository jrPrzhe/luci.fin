# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è VK Mini App

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ VK Mini Apps –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. **–û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ –∫–æ–¥, —á—Ç–æ –∏ –¥–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–∏ –∏ Telegram Mini App.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:

1. **Frontend:**
   - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `@vkontakte/vk-bridge`
   - –°–æ–∑–¥–∞–Ω–∞ —É—Ç–∏–ª–∏—Ç–∞ `frontend/src/utils/vk.ts` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å VK Bridge
   - –î–æ–±–∞–≤–ª–µ–Ω `VKAuthHandler` –≤ `App.tsx` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `loginVK` –≤ API –∫–ª–∏–µ–Ω—Ç

2. **Backend:**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `vk_id` –≤ –º–æ–¥–µ–ª—å `User`
   - –°–æ–∑–¥–∞–Ω endpoint `/api/v1/auth/vk` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ VK
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ VK

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—è vk_id

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª–∏ User –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
cd finance-manager/backend
alembic revision --autogenerate -m "Add vk_id to users"
alembic upgrade head
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VK Mini App

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ [VK Developers](https://dev.vk.com/)
2. –£–∫–∞–∂–∏—Ç–µ URL –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `App ID` –∏ `Secret Key` (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 3. –î–µ–ø–ª–æ–π

–ü—Ä–∏ –¥–µ–ø–ª–æ–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ VK Mini App –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤ VK, –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ VK Bridge.

## üìù –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:**
   - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –æ–Ω–æ –≤ VK (–ø–æ –Ω–∞–ª–∏—á–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `vk_*` –≤ URL)
   - –ï—Å–ª–∏ –¥–∞ - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è VK Bridge

2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
   - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `VKAuthHandler` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ launch params
   - –ï—Å–ª–∏ –µ—Å—Ç—å `vk_user_id` - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/v1/auth/vk`
   - Backend —Å–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `vk_id`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã

3. **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å VK –∏–º–µ–µ—Ç —Å–≤–æ–π `vk_id`
   - –î–∞–Ω–Ω—ã–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ `vk_id` (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Telegram)

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è VK

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–º—è –∏ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VK API:

```typescript
import bridge from '@vkontakte/vk-bridge'

const userInfo = await bridge.send('VKWebAppGetUserInfo')
// userInfo —Å–æ–¥–µ—Ä–∂–∏—Ç: id, first_name, last_name, photo_200, photo_100
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ launch params

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ `sign` –≤ launch params. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ:

1. –î–æ–±–∞–≤–∏—Ç—å `VK_APP_SECRET` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backend
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –≤ endpoint `/api/v1/auth/vk`

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `login_vk`):

```python
import hmac
import hashlib

def verify_vk_sign(params: dict, secret: str) -> bool:
    """Verify VK launch params signature"""
    sign = params.pop('sign', '')
    if not sign:
        return False
    
    # Sort params and create query string
    sorted_params = sorted(params.items())
    query_string = '&'.join([f"{k}={v}" for k, v in sorted_params])
    
    # Calculate hash
    calculated_sign = hmac.new(
        secret.encode(),
        query_string.encode(),
        hashlib.md5
    ).hexdigest()
    
    return calculated_sign == sign
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î:** –ù–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è `vk_id`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ VK Mini App –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è VK

- [VK Mini Apps Documentation](https://dev.vk.com/mini-apps)
- [VK Bridge API](https://dev.vk.com/mini-apps/development/launch-params)
- [VK Bridge Methods](https://dev.vk.com/mini-apps/development/bridge)



