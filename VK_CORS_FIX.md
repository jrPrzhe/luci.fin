# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–≥—Ä—É–∑–∫–∏ VK Mini App

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

VK Mini App –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è. –í –ª–æ–≥–∞—Ö backend –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ `/api/v1/auth/vk`.

## üîç –ü—Ä–∏—á–∏–Ω–∞

CORS (Cross-Origin Resource Sharing) –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –¥–æ–º–µ–Ω–æ–≤ VK (`vk.com`, `m.vk.com`).

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–±–Ω–æ–≤–∏—Ç—å CORS_ORIGINS –Ω–∞ Railway (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Railway](https://railway.app)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à **Backend —Å–µ—Ä–≤–∏—Å**
3. –û—Ç–∫—Ä–æ–π—Ç–µ **Settings** ‚Üí **Variables**
4. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `CORS_ORIGINS`
5. –û–±–Ω–æ–≤–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –¥–æ–±–∞–≤–∏–≤ –¥–æ–º–µ–Ω—ã VK:

**–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
```
https://luci-fin-kb8p.vercel.app,https://vk.com,https://m.vk.com
```

**–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ—Ç:**
- –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
- **Name**: `CORS_ORIGINS`
- **Value**: `https://luci-fin-kb8p.vercel.app,https://vk.com,https://m.vk.com`

6. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å regex (–£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥)

–í –∫–æ–¥–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω regex –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ VK –¥–æ–º–µ–Ω–æ–≤:
```python
allow_origin_regex=r"...|https://.*\.vk\.com|https://vk\.com|https://m\.vk\.com"
```

–ù–æ –ª—É—á—à–µ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥–æ–º–µ–Ω—ã –≤ `CORS_ORIGINS` –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `CORS_ORIGINS` –Ω–∞ Railway:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ VK
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Network**
3. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/v1/auth/vk`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:
   - –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `Access-Control-Allow-Origin: https://vk.com` –∏–ª–∏ `https://m.vk.com`
   - –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å CORS –æ—à–∏–±–æ–∫

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend

–í –ª–æ–≥–∞—Ö Railway –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å—ã:
```
INFO: ... "POST /api/v1/auth/vk HTTP/1.1" 200 OK
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ `400 Bad Request` –∏–ª–∏ `403 Forbidden` - –ø—Ä–æ–±–ª–µ–º–∞ –≤ CORS.

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
```javascript
VK auto-auth check: { hasLaunchParams: true, ... }
Attempting automatic VK login...
```

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ CORS –æ—à–∏–±–∫—É:
```
Access to fetch at '...' from origin 'https://vk.com' has been blocked by CORS policy
```

–ó–Ω–∞—á–∏—Ç CORS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

## üö® –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç CORS_ORIGINS

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
https://luci-fin-kb8p.vercel.app,https://vk.com,https://m.vk.com
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
```
https://luci-fin-kb8p.vercel.app, https://vk.com, https://m.vk.com  (–ø—Ä–æ–±–µ–ª—ã –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç—ã—Ö)
vk.com  (–±–µ–∑ https://)
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è

1. –í Railway –æ—Ç–∫—Ä–æ–π—Ç–µ **Deployments**
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏:
   ```
   [STARTUP] Running migrations...
   [STARTUP] All routers included, application ready!
   ```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ VK

1. –û—Ç–∫—Ä–æ–π—Ç–µ [VK Developers](https://dev.vk.com/apps)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ **"URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## üìù –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è CORS:

1. ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –≤ VK
2. ‚úÖ –î–æ–ª–∂–Ω–∞ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
3. ‚úÖ –í –ª–æ–≥–∞—Ö backend –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø—Ä–æ—Å—ã –∫ `/api/v1/auth/vk`
4. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `CORS_ORIGINS` –Ω–∞ Railway –ø–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã, –ø–æ–∫–∞ —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è, –∑–∞—Ç–µ–º –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ VK.











