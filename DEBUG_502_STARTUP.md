# Отладка 502 Bad Gateway при старте

## Проблема

Бэкенд возвращает 502 Bad Gateway, логи показывают "connection refused" и "Starting Container". Приложение не запускается.

## Возможные причины

### 1. Ошибка при импорте модулей

Проверьте, нет ли синтаксических ошибок в последних изменениях.

### 2. Проблема с DATABASE_URL

Если DATABASE_URL неверный или БД недоступна, приложение может падать при старте.

### 3. Проблема с переменными окружения

Отсутствие обязательных переменных может вызвать краш.

### 4. Ошибка в коде при инициализации

Проверьте логи Railway на наличие ошибок Python.

## Шаги отладки

### Шаг 1: Проверьте логи Railway

1. Откройте Railway → Backend сервис → **Deployments**
2. Откройте последний деплой
3. Перейдите в **Logs**
4. Ищите ошибки Python (Traceback, ImportError, SyntaxError и т.д.)

### Шаг 2: Проверьте переменные окружения

В Railway → Backend → Variables проверьте:

- ✅ `DATABASE_URL` - должен указывать на `postgresql://finance_user:пароль@195.43.142.121:5432/finance_db`
- ✅ `SECRET_KEY` - должен быть установлен
- ✅ `ADMIN_TELEGRAM_IDS` - опционально, но должен быть валидным JSON или пустым

### Шаг 3: Проверьте подключение к БД

```bash
# Проверка подключения с вашего компьютера
psql -h 195.43.142.121 -U finance_user -d finance_db -c "SELECT 1;"
```

### Шаг 4: Локальная проверка

Попробуйте запустить бэкенд локально:

```bash
cd finance-manager/backend
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

Если есть ошибки - они появятся в консоли.

### Шаг 5: Проверьте последние изменения

Последние изменения, которые могли вызвать проблему:
- `Profile.tsx` - изменения в синхронизации админа
- `api.ts` - добавлен метод `syncAdminStatus()`

Но эти изменения во фронтенде, не должны влиять на бэкенд.

## Быстрое решение

### Вариант 1: Откат к предыдущему деплою

1. Railway → Backend → Deployments
2. Найдите последний рабочий деплой
3. Нажмите "Redeploy"

### Вариант 2: Проверка DATABASE_URL

Убедитесь, что `DATABASE_URL` в Railway правильный:

```
postgresql://finance_user:ваш_пароль@195.43.142.121:5432/finance_db
```

### Вариант 3: Перезапуск сервиса

1. Railway → Backend → Settings
2. Нажмите "Restart"

## Проверка логов в реальном времени

Если Railway показывает только "Starting Container", попробуйте:

1. Railway → Backend → Logs
2. Обновите страницу
3. Ищите ошибки Python

## Типичные ошибки

### ImportError
```
ImportError: cannot import name 'X' from 'Y'
```
**Решение:** Проверьте импорты в измененных файлах

### Database connection error
```
OperationalError: could not connect to server
```
**Решение:** Проверьте DATABASE_URL и доступность БД

### SyntaxError
```
SyntaxError: invalid syntax
```
**Решение:** Проверьте синтаксис Python в последних изменениях

## Следующие шаги

1. Проверьте логи Railway на наличие ошибок
2. Проверьте DATABASE_URL
3. Попробуйте перезапустить сервис
4. Если не поможет - откатитесь к предыдущему деплою











