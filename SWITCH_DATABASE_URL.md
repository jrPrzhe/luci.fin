# Переключение DATABASE_URL на новую БД

## ⚠️ ВАЖНО: Нужно ли менять DATABASE_URL?

**ДА, нужно переключить**, если:
- На Railway еще используется старая БД (Railway PostgreSQL или другая)
- Вы хотите использовать новую БД на сервере 195.43.142.121

**НЕТ, не нужно**, если:
- DATABASE_URL уже указывает на 195.43.142.121
- Вы уже переключили ранее

## Проверка текущего DATABASE_URL

### Способ 1: Через Railway Dashboard

1. Откройте ваш проект на [railway.app](https://railway.app)
2. Откройте **Backend сервис**
3. Перейдите в **Variables**
4. Найдите `DATABASE_URL`
5. Проверьте значение

**Если DATABASE_URL содержит:**
- `195.43.142.121` → ✅ **Уже настроено, менять не нужно**
- `railway.app` или другой хост → ⚠️ **Нужно переключить**

### Способ 2: Через логи Railway

В логах Railway ищите строки:
- `Database URL: postgresql://...@195.43.142.121...` → ✅ Уже настроено
- `Database URL: postgresql://...@containers-us-west...` → ⚠️ Нужно переключить

## Как переключить DATABASE_URL

### Шаг 1: Подготовьте новую строку подключения

Формат:
```
postgresql://finance_user:ваш_пароль@195.43.142.121:5432/finance_db
```

⚠️ **Замените `ваш_пароль` на реальный пароль**, который вы установили для `finance_user`.

### Шаг 2: Обновите в Railway

1. Откройте ваш проект на Railway
2. Откройте **Backend сервис**
3. Перейдите в **Variables**
4. Найдите `DATABASE_URL`
5. Нажмите на значение (или кнопку редактирования)
6. Измените на:
   ```
   postgresql://finance_user:ваш_пароль@195.43.142.121:5432/finance_db
   ```
7. Сохраните изменения

⚠️ **Railway автоматически перезапустит сервис** после изменения переменных (~1-2 минуты простоя).

### Шаг 3: Проверка после переключения

1. Дождитесь перезапуска сервиса
2. Проверьте логи Railway — не должно быть ошибок подключения
3. Проверьте работу API:
   ```bash
   curl https://your-backend.railway.app/docs
   ```

## Миграция данных (если нужно)

Если в старой БД есть важные данные:

### Экспорт из старой БД

```bash
# Если старая БД на Railway
railway run pg_dump $DATABASE_URL > backup.sql

# Или если другая БД
pg_dump -h старый_хост -U пользователь -d база > backup.sql
```

### Импорт в новую БД

```bash
psql -h 195.43.142.121 -U finance_user -d finance_db < backup.sql
```

⚠️ **ВНИМАНИЕ:** Если структура уже создана миграциями, импортируйте только данные:
```bash
pg_dump -h старый_хост -U пользователь -d база --data-only > data.sql
psql -h 195.43.142.121 -U finance_user -d finance_db < data.sql
```

## Откат (если что-то пошло не так)

Если после переключения возникли проблемы:

1. В Railway → Variables
2. Верните старую `DATABASE_URL`
3. Railway перезапустит сервис

## Чек-лист переключения

- [ ] Проверен текущий DATABASE_URL
- [ ] Подготовлена новая строка подключения
- [ ] Бэкап старой БД создан (если есть данные)
- [ ] DATABASE_URL обновлен в Railway
- [ ] Сервис перезапущен
- [ ] Логи проверены (нет ошибок)
- [ ] API работает корректно

## Быстрая команда для проверки

```bash
# Проверка подключения к новой БД
psql -h 195.43.142.121 -U finance_user -d finance_db -c "SELECT current_database(), current_user;"
```

Если подключение работает — можно переключать DATABASE_URL в Railway.













