# –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–æ–¥–∞ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–¥–∞ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞—Ç—É—Å:** –ö–æ–¥ **–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω** –¥–ª—è —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö.

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:

1. ‚úÖ **–ú–æ–¥–µ–ª–∏ SQLAlchemy —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ö–µ–º–µ –ë–î**
   - –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –í—Å–µ –ø–æ–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –º–æ–¥–µ–ª—è–º
   - –í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. ‚úÖ **API endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è**
   - `shared_budget_id` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - `created_by` –≤ shared_budgets (–Ω–µ owner_id)
   - –í—Å–µ relationships —Ä–∞–±–æ—Ç–∞—é—Ç

3. ‚úÖ **–ö–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞**
   - –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞–±–æ—Ç–∞—é—Ç
   - `client_encoding: utf8` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

4. ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ —Å 0.5–ì–ë RAM**
   - –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (5+5)
   - PostgreSQL –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω

## ‚ö†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. N+1 Query Problem (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–ë—ã–ª–æ:**
```python
for t in transactions:
    account = db.query(Account).filter(Account.id == t.account_id).first()  # N+1!
    category = db.query(Category).filter(Category.id == t.category_id).first()  # N+1!
```

**–°—Ç–∞–ª–æ:**
```python
from sqlalchemy.orm import joinedload
transactions = query.options(
    joinedload(Transaction.account),
    joinedload(Transaction.category),
    joinedload(Transaction.goal)
).all()
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –í–º–µ—Å—Ç–æ 1 + N –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç–µ–ø–µ—Ä—å 1 –∑–∞–ø—Ä–æ—Å —Å JOIN.

---

## üîç –ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å 0.5–ì–ë RAM

**–†–∏—Å–∫–∏:**
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–∞–º—è—Ç–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (max_connections=20)

**–ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–æ 5+5
- ‚úÖ PostgreSQL –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (shared_buffers=64MB)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º–∞ –≤ transactions.py

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã** –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è (—Å–º. `CHECK_INDEXES.md`)
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ë–î
3. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –≤—ã–±–æ—Ä–æ–∫** (—É–∂–µ –µ—Å—Ç—å limit=50 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é** –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

---

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω—ã–µ –ø–æ–ª—è –º–æ–≥—É—Ç –Ω–µ –∏–º–µ—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤.

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
```sql
-- transactions
CREATE INDEX IF NOT EXISTS idx_transactions_user_id ON transactions(user_id);
CREATE INDEX IF NOT EXISTS idx_transactions_account_id ON transactions(account_id);
CREATE INDEX IF NOT EXISTS idx_transactions_date ON transactions(transaction_date);
CREATE INDEX IF NOT EXISTS idx_transactions_user_date ON transactions(user_id, transaction_date DESC);

-- accounts
CREATE INDEX IF NOT EXISTS idx_accounts_user_id ON accounts(user_id);
CREATE INDEX IF NOT EXISTS idx_accounts_shared_budget_id ON accounts(shared_budget_id);

-- categories
CREATE INDEX IF NOT EXISTS idx_categories_user_id ON categories(user_id);
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
psql -h 195.43.142.121 -U finance_user -d finance_db -c "
SELECT tablename, indexname 
FROM pg_indexes 
WHERE schemaname = 'public' 
AND tablename IN ('transactions', 'accounts', 'categories')
ORDER BY tablename;
"
```

**–†–∏—Å–∫:** –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö.

---

### 3. –ü–æ–¥—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞ —Å—á–µ—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞–ª–∞–Ω—Å –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ Python —Ü–∏–∫–ª–µ.

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
transactions = db.query(Transaction).filter(...).all()
balance = Decimal(str(account.initial_balance))
for trans in transactions:
    balance += Decimal(str(trans.amount))  # –∏–ª–∏ -=
```

**–†–∏—Å–∫:** –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —ç—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î:
```python
from sqlalchemy import func, case

result = db.query(
    func.sum(
        case(
            (Transaction.transaction_type == TransactionType.INCOME, Transaction.amount),
            (Transaction.transaction_type == TransactionType.EXPENSE, -Transaction.amount),
            else_=0
        )
    )
).filter(Transaction.account_id == account_id).scalar() or 0

balance = account.initial_balance + result
```

---

### 4. –ö–∞—Å–∫–∞–¥–Ω—ã–µ —É–¥–∞–ª–µ–Ω–∏—è

**–¢–µ–∫—É—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**
```python
accounts = relationship("Account", cascade="all, delete-orphan")
```

**–†–∏—Å–∫:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–¥–∞–ª—è—Ç—Å—è –≤—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–ª—è production —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å "–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ" (is_active=False)
- –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å cascade –Ω–∞ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

---

### 5. –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ–Ω–µ–≥

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `float`, –Ω–æ –≤ –ë–î `Numeric(15,2)`.

**–†–∏—Å–∫:** –ü–æ—Ç–µ—Ä—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–µ–Ω—å–≥–∞–º–∏.

**–£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –º–µ—Å—Ç:**
```python
initial_balance=Decimal(str(account_data.initial_balance))
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Decimal` –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—É–º–º.

---

### 6. –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–†–∏—Å–∫–∏:**
- –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å—É–º–º—ã –¥–ª—è –¥–æ—Ö–æ–¥–æ–≤
- –î–∞—Ç—ã –≤ –±—É–¥—É—â–µ–º –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—Å—á–µ—Ç–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ Pydantic —Å—Ö–µ–º—ã –∏ API endpoints.

---

### 7. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–†–∏—Å–∫:** –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å—á–µ—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –æ–±—â–∏—Ö –±—é–¥–∂–µ—Ç–∞—Ö
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–π

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è deadlock —Å–∏—Ç—É–∞—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SELECT FOR UPDATE` –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

---

### 8. –õ–æ–≥–∏–∫–∞ –æ–±—â–∏—Ö –±—é–¥–∂–µ—Ç–æ–≤

**–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-—Å–æ–∑–¥–∞—Ç–µ–ª—è –æ–±—â–µ–≥–æ –±—é–¥–∂–µ—Ç–∞?

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
- `created_by` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–æ–∑–¥–∞—Ç–µ–ª—è
- –ù–æ –±—é–¥–∂–µ—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–Ω –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
- –ò–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ –¥—Ä—É–≥–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É (admin)
- –ò–ª–∏ –∑–∞–ø—Ä–µ—â–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω —Å–æ–∑–¥–∞–ª –∞–∫—Ç–∏–≤–Ω—ã–µ –±—é–¥–∂–µ—Ç—ã

---

### 9. Nullable –ø–æ–ª—è

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- `category_id` –º–æ–∂–µ—Ç –±—ã—Ç—å NULL - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤ –∫–æ–¥–µ
- `goal_id` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å
- `shared_budget_id` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - –ª–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ —ç—Ç–æ —É—á–∏—Ç—ã–≤–∞—Ç—å

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞ None –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.

---

### 10. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**

1. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–π –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤
   - –ù—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `category_id` –∏ `transaction_date`

2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º:**
   - –ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ `transaction_date` –±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å `(user_id, transaction_date)`

3. **–ó–∞–ø—Ä–æ—Å—ã –æ–±—â–∏—Ö –±—é–¥–∂–µ—Ç–æ–≤:**
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ JOIN –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏
   - –ù—É–∂–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `shared_budget_id` –≤ accounts –∏ transactions

---

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å):

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º–∞** –≤ transactions.py
2. ‚ö†Ô∏è **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã** –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è
3. ‚ö†Ô∏è **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ë–î

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–¥–µ–ª–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):

1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SUM –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î)
2. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ N+1 –ø—Ä–æ–±–ª–µ–º—ã

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å):

1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
2. –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ retry –ª–æ–≥–∏–∫–∏ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

---

## üîß –ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ë–î)

```bash
psql -h 195.43.142.121 -U finance_user -d finance_db << 'EOF'
-- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX IF NOT EXISTS idx_transactions_user_id ON transactions(user_id);
CREATE INDEX IF NOT EXISTS idx_transactions_account_id ON transactions(account_id);
CREATE INDEX IF NOT EXISTS idx_transactions_date ON transactions(transaction_date);
CREATE INDEX IF NOT EXISTS idx_transactions_user_date ON transactions(user_id, transaction_date DESC);
CREATE INDEX IF NOT EXISTS idx_transactions_category_id ON transactions(category_id);

CREATE INDEX IF NOT EXISTS idx_accounts_user_id ON accounts(user_id);
CREATE INDEX IF NOT EXISTS idx_accounts_shared_budget_id ON accounts(shared_budget_id);

CREATE INDEX IF NOT EXISTS idx_categories_user_id ON categories(user_id);
CREATE INDEX IF NOT EXISTS idx_categories_shared_budget_id ON categories(shared_budget_id);

CREATE INDEX IF NOT EXISTS idx_budget_members_user_budget ON shared_budget_members(user_id, shared_budget_id);
EOF
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```sql
-- –í–∫–ª—é—á–∏—Ç—å pg_stat_statements (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω)
CREATE EXTENSION IF NOT EXISTS pg_stat_statements;

-- –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT 
    query,
    calls,
    total_exec_time,
    mean_exec_time
FROM pg_stat_statements 
ORDER BY mean_exec_time DESC 
LIMIT 10;
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–¥–∞ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö:** ‚úÖ **–•–û–†–û–®–ï–ï**

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ N+1 –ø—Ä–æ–±–ª–µ–º–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** ‚úÖ **–ì–û–¢–û–í–û** (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤)

---

üìñ **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:**
- `POTENTIAL_ISSUES.md` - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º
- `CHECK_INDEXES.md` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- `MONITOR_DB_LOGS.md` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –ë–î













